import pandas as pd
import operator

df = pd.read_excel('https://fingertips.phe.org.uk/documents/Historic%20COVID-19%20Dashboard%20Data.xlsx', sheet_name='UTLAs')

populations = {
    "Hartlepool":93242,
    "Middlesbrough":138400,
    "Redcar and Cleveland": 136718,
    "Stockton-on-Tees": 197213,
    "Darlington": 106000,
    "Halton": 128432,
    "Warrington": 202200,
    "Blackburn with Darwen": 148942,
    "Blackpool": 139300,
    "Kingston upon Hull, City of": 284321,
    "East Riding of Yorkshire": 334179,
    "North East Lincolnshire": 159821,
    "North Lincolnshire": 172005,
    "York": 208200,
    "Derby": 248700,
    "Leicester": 329839,
    "Rutland": 37369,
    "Nottingham": 289301,
    "Herefordshire, County of": 191000,
    "Telford and Wrekin": 169400,
    "Stoke-on-Trent": 270726,
    "Bath and North East Somerset": 192106,
    "Bristol, City of": 463405,
    "North Somerset": 213919,
    "South Gloucestershire": 282644,
    "Plymouth": 263100,
    "Torbay": 135780,
    "Swindon": 221996,
    "Peterborough": 201041,
    "Luton": 214109,
    "Southend-on-Sea": 182463,
    "Thurrock": 172525,
    "Medway": 277855,
    "Bracknell Forest": 121675,
    "West Berkshire": 158527,
    "Reading": 163203,
    "Slough": 149112,
    "Windsor and Maidenhead": 150906,
    "Wokingham": 101167,
    "Milton Keynes": 268607,
    "Brighton and Hove": 290395,
    "Portsmouth": 215133,
    "Southampton": 252796,
    "Isle of Wight": 141538,
    "County Durham": 526980,
    "Cheshire East": 380790,
    "Cheshire West and Chester": 340502,
    "Shropshire": 320274,
    "Cornwall and Isles of Scilly": 568210,
    "Wiltshire": 498064,
    "Bedford": 171623,
    "Central Bedfordshire": 283606,
    "Northumberland": 320274,
    "Bournemouth, Christchurch and Poole": 395784,
    "Dorset": 376484,
    "Bolton": 285372,
    "Bury": 190108,
    "Manchester": 547627,
    "Oldham": 235623,
    "Rochdale": 220001,
    "Salford": 254408,
    "Stockport": 291775,
    "Tameside": 225197,
    "Trafford": 236370,
    "Wigan": 326088,
    "Knowsley": 149571,
    "Liverpool": 494814,
    "St. Helens": 180049,
    "Sefton": 275369,
    "Wirral": 323235,
    "Barnsley": 245199,
    "Doncaster": 310542,
    "Rotherham": 264671,
    "Sheffield": 582506,
    "Newcastle upon Tyne": 300196,
    "North Tyneside": 205985,
    "South Tyneside": 150265,
    "Sunderland": 277417,
    "Birmingham": 1141374,
    "Coventry": 366785,
    "Dudley": 320626,
    "Sandwell": 327378,
    "Solihull": 214909,
    "Walsall": 283378,
    "Wolverhampton": 262008,
    "Bradford": 5537173,
    "Calderdale": 210082,
    "Kirklees": 438727,
    "Leeds": 789194,
    "Wakefield": 345038,
    "Gateshead": 202508,
    "Barking and Dagenham": 211998,
    "Barnet": 392140,
    "Bexley": 247258,
    "Brent": 330795,
    "Bromley": 331096,
    "Camden": 262226,
    "Croydon": 385346,
    "Ealing": 341982,
    "Enfield": 333869,
    "Greenwich": 286186,
    "Hackney and City of London": 288371,
    "Hammersmith and Fulham": 185426,
    "Haringey": 270624,
    "Harrow": 250149,
    "Havering": 257810,
    "Hillingdon": 304824,
    "Hounslow": 270782,
    "Islington": 239142,
    "Kensington and Chelsea": 156197,
    "Kingston upon Thames": 175470,
    "Lambeth": 325917,
    "Lewisham": 303536,
    "Merton": 206186,
    "Newham": 352005,
    "Redbridge": 303858,
    "Richmond upon Thames": 196904,
    "Southwark": 317256,
    "Sutton": 204525,
    "Tower Hamlets": 317705,
    "Waltham Forest": 276700,
    "Wandsworth": 326474,
    "Westminster": 255324,
    "Buckinghamshire": 540049,
    "Cambridgeshire": 651482,
    "Cumbria": 498888,
    "Derbyshire": 1053316,
    "Devon": 795286,
    "East Sussex": 844985,
    "Essex": 1478000,
    "Gloucestershire": 633558,
    "Hampshire": 1844245,
    "Hertfordshire": 1184000,
    "Kent": 1569000,
    "Lancashire": 1210000,
    "Leicestershire": 698268,
    "Lincolnshire": 755833,
    "Norfolk": 242628,
    "Northamptonshire": 747622,
    "North Yorkshire": 604900,
    "Nottinghamshire": 823126,
    "Oxfordshire": 687524,
    "Somerset": 559399,
    "Staffordshire": 875219,
    "Suffolk": 730000,
    "Surrey": 1190000,
    "Warwickshire": 571010,
    "West Sussex": 858852,
    "Worcestershire": 592057,
}

out = {}

for x in range(8,157):
    area = df.at[x, 'Unnamed: 1']
    cases = df.at[x, df.columns.tolist()[-1]]
    population = populations.get(area)
    cases_per_pop = population/cases
    out[area] = cases_per_pop

sorted_dict = sorted(out.items(), key=lambda x: x[1])

for x in sorted_dict:
    print(x[0]+" : "+str(round(x[1])))
